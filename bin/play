#!/usr/bin/env ruby

require 'dispel'
require 'pry'
require './nethack'

# set up the map
map = Map.new(height: 30, width: 40)
map_generator = MapGenerator.new(map: map)
map_generator.generate_cave

# set up the game mechanics
game = Game.new(map: map)
environment = game.setup
player = environment.fetch(:player)

ui = UiHelper.new(map: map, player: player)

Dispel::Screen.open do |screen|

  screen.draw ui.draw

  Dispel::Keyboard.output do |key|
    break if key == :"Ctrl+c"
    game.step(key)
    screen.draw ui.draw
  end
end
